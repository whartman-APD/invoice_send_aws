version: '3.8'

services:
  invoice-processor:
    build: .
    image: qbo-invoice-processor:latest
    container_name: qbo-invoice-processor

    # Environment variables from .env file
    environment:
      # AWS Configuration (using IAM credentials from .env)
      - AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}
      - AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}
      - AWS_REGION=${AWS_REGION:-us-west-2}

      # AWS Secrets Manager Secret Names
      - QBO_SECRET_NAME=${QBO_SECRET_NAME:-QBO/10000}
      - MSGRAPH_SECRET_NAME=${MSGRAPH_SECRET_NAME:-MsGraph/10000}
      - CLICKUP_SECRET_NAME=${CLICKUP_SECRET_NAME:-ClickUp/10000}
      - ROBOCORP_API_SECRET_NAME=${ROBOCORP_API_SECRET_NAME:-RoboCorp/10000/ClientAPIKeys}

      # DynamoDB Table
      - DYNAMODB_TABLE_ROBOCORP_CLIENTS=${DYNAMODB_TABLE_ROBOCORP_CLIENTS:-Robocorp_Client_Org_Workspace_IDs}

      # Email Configuration
      - BOOKKEEPER_EMAIL=${BOOKKEEPER_EMAIL:-whartman@automatapracdev.com}
      - SENDER_EMAIL=${SENDER_EMAIL:-robotarmy@automatapracdev.com}
      - EXCLUDED_CUSTOMERS=${EXCLUDED_CUSTOMERS:-10001 - AICPA}

      # Microsoft Graph Configuration
      - MS_GRAPH_HOSTNAME=${MS_GRAPH_HOSTNAME:-automatapracdev.sharepoint.com}

      # Invoice Creation Configuration
      - UPLOAD_TO_SHAREPOINT=${UPLOAD_TO_SHAREPOINT:-false}
      - CREATE_INVOICE=${CREATE_INVOICE:-false}
      - UPDATE_CLICKUP=${UPDATE_CLICKUP:-false}
      - LOWER_CLIENT_ID=${LOWER_CLIENT_ID:-10000}
      - UPPER_CLIENT_ID=${UPPER_CLIENT_ID:-20030}
      - NET_30_DAYS_CLIENTS=${NET_30_DAYS_CLIENTS:-10020}

      # Azure SQL Server Configuration
      - AZURE_SQL_SERVER=${AZURE_SQL_SERVER}
      - AZURE_SQL_DATABASE=${AZURE_SQL_DATABASE}
      - AZURE_SQL_USERNAME=${AZURE_SQL_USERNAME}
      - AZURE_SQL_PASSWORD=${AZURE_SQL_PASSWORD}
